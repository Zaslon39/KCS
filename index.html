
            showNotification("–î–æ–±–∞–≤–ª–µ–Ω–æ", false);
        };
        
        window.removeFromCart = (i) => { cart.splice(i, 1); updateCartUI(); renderCartItems(); };
        function updateCartUI() {
            const b = document.getElementById('cart-badge');
            b.textContent = cart.length; b.classList.toggle('hidden', cart.length === 0);
        }
        window.openCart = () => { document.getElementById('cart-modal').classList.add('active'); renderCartItems(); };
        window.closeCart = () => document.getElementById('cart-modal').classList.remove('active');

        function renderCartItems() {
            const c = document.getElementById('cart-items');
            if (!cart.length) { c.innerHTML = '<p class="text-center py-10 opacity-50">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>'; document.getElementById('total-rub').innerText = '0 ‚ÇΩ'; return; }
            let sr = 0, se = 0;
            
            c.innerHTML = cart.map((item, i) => {
                sr += getPrice(item); se += getPrice(item, 'eur');
                return `<div class="flex gap-3 items-center p-2 rounded-lg border border-gray-100/10 bg-gray-50/5"><img src="${item.image}" class="w-12 h-12 object-contain bg-white rounded"><div class="flex-grow min-w-0"><div class="text-sm font-medium truncate">${item.title}</div><div class="text-xs opacity-70">${item.price_rub} ‚ÇΩ</div></div><button onclick="removeFromCart(${i})" class="p-2 text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`;
            }).join('');
            document.getElementById('total-rub').innerText = sr + ' ‚ÇΩ'; document.getElementById('total-eur').innerText = se + ' ‚Ç¨';
            lucide.createIcons();
        }

        window.checkout = () => {
            if(!cart.length) return;
            const grouped = {};
            let total = 0;
            
            cart.forEach(item => {
                if(!grouped[item.title]) grouped[item.title] = { count: 0, price: getPrice(item) };
                grouped[item.title].count++;
                total += getPrice(item);
            });

            let msg = `üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, @${ADMIN}!\n\n–ó–∞–∫–∞–∑:\n`;
            let idx = 1;
            for (const [title, data] of Object.entries(grouped)) {
                msg += `${idx}. ${title} ‚Äî ${data.count} —à—Ç. (${data.price * data.count}‚ÇΩ)\n`;
                idx++;
            }
            msg += `\nüí∞ –ò–¢–û–ì–û: ${total}‚ÇΩ`;
            tg.openTelegramLink(`https://t.me/${ADMIN}?text=${encodeURIComponent(msg)}`);
        };

        function sortCatalog() {
            const method = document.getElementById('sort-select').value;
            displayedProducts.sort((a, b) => {
                const aSold = checkSold(a); const bSold = checkSold(b);
                if (aSold && !bSold) return 1; if (!aSold && bSold) return -1;
                if (method === 'price_asc') return getPrice(a) - getPrice(b);
                if (method === 'price_desc') return getPrice(b) - getPrice(a);
                if (method === 'alpha') return a.title.localeCompare(b.title);
                if (method === 'new') return (b.new ? 1 : 0) - (a.new ? 1 : 0);
                return 0;
            });
            renderCatalog(displayedProducts);
        }

        function checkSold(item) { return item.status && (item.status.toLowerCase().includes('sold') || item.status.toLowerCase().includes('–ø—Ä–æ–¥–∞–Ω–æ')); }
        function getPrice(item, type = 'rub') { const val = type === 'rub' ? item.price_rub : item.price_eur; return parseInt((val || '0').toString().replace(/\D/g,'')) || 0; }
        
        function showNotification(text, isError = false) { 
            const n = document.getElementById('notification'); 
            n.innerText = text;
            if (isError) {
                n.classList.remove('bg-black/80'); n.classList.add('bg-red-600/90');
            } else {
                n.classList.add('bg-black/80'); n.classList.remove('bg-red-600/90');
            }
            n.classList.remove('opacity-0'); 
            setTimeout(() => n.classList.add('opacity-0'), 2000); 
        }

        init();
    </script>
</body>
</html>
